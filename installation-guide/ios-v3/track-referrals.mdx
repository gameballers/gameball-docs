---
title: "Track Referrals"
description: "Implement referral tracking using Firebase Dynamic Links"
---

# Track Referrals

Gameball referrals use Firebase Dynamic Links to track when customers invite their friends. Implement referral tracking to reward both the referrer and the referred customer.

## Setup

<Steps>
<Step title="Configure Firebase Dynamic Links">
Set up Firebase Dynamic Links in your Firebase console and configure your app to handle deep links.
</Step>

<Step title="Add Firebase SDK">
Add Firebase Dynamic Links to your project via CocoaPods:

```ruby
pod 'Firebase/DynamicLinks'
```

Or via Swift Package Manager: `https://github.com/firebase/firebase-ios-sdk`
</Step>

<Step title="Configure in Gameball Dashboard">
Provide your Firebase Dynamic Links configuration in the Gameball dashboard.
</Step>
</Steps>

## Handle Deep Links

### UIKit Implementation

Configure your app to receive Firebase Dynamic Links in `AppDelegate`:

```swift
import UIKit
import Firebase
import Gameball

@main
class AppDelegate: UIResponder, UIApplicationDelegate {
    
    func application(
        _ application: UIApplication,
        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
    ) -> Bool {
        
        FirebaseApp.configure()
        
        return true
    }
    
    func application(
        _ app: UIApplication,
        open url: URL,
        options: [UIApplication.OpenURLOptionsKey : Any] = [:]
    ) -> Bool {
        
        return application(app, open: url,
                         sourceApplication: options[.sourceApplication] as? String,
                         annotation: "")
    }
    
    func application(
        _ application: UIApplication,
        open url: URL,
        sourceApplication: String?,
        annotation: Any
    ) -> Bool {
        
        if let dynamicLink = DynamicLinks.dynamicLinks().dynamicLink(fromCustomSchemeURL: url) {
            handleDynamicLink(dynamicLink)
            return true
        }
        
        return false
    }
    
    func application(
        _ application: UIApplication,
        continue userActivity: NSUserActivity,
        restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void
    ) -> Bool {
        
        let handled = DynamicLinks.dynamicLinks().handleUniversalLink(userActivity.webpageURL!) { dynamicLink, error in
            if let dynamicLink = dynamicLink {
                self.handleDynamicLink(dynamicLink)
            }
        }
        
        return handled
    }
    
    func handleDynamicLink(_ dynamicLink: DynamicLink) {
        guard let url = dynamicLink.url else { return }
        
        // Extract referral code from URL
        if let components = URLComponents(url: url, resolvingAgainstBaseURL: false),
           let queryItems = components.queryItems {
            
            let referralCode = queryItems.first(where: { $0.name == "referralCode" })?.value
            
            if let code = referralCode {
                // Store referral code to use during registration
                saveReferralCode(code)
            }
        }
    }
    
    func saveReferralCode(_ code: String) {
        UserDefaults.standard.set(code, forKey: "pendingReferralCode")
    }
}
```

### SwiftUI Implementation

```swift
import SwiftUI
import Firebase

@main
struct YourApp: App {
    @UIApplicationDelegateAdaptor(AppDelegate.self) var appDelegate
    
    var body: some Scene {
        WindowGroup {
            ContentView()
                .onOpenURL { url in
                    handleIncomingURL(url)
                }
        }
    }
    
    func handleIncomingURL(_ url: URL) {
        DynamicLinks.dynamicLinks().handleUniversalLink(url) { dynamicLink, error in
            guard error == nil, let dynamicLink = dynamicLink else {
                return
            }
            
            if let url = dynamicLink.url,
               let components = URLComponents(url: url, resolvingAgainstBaseURL: false),
               let queryItems = components.queryItems {
                
                let referralCode = queryItems.first(where: { $0.name == "referralCode" })?.value
                
                if let code = referralCode {
                    UserDefaults.standard.set(code, forKey: "pendingReferralCode")
                }
            }
        }
    }
}
```

## Register Customer with Referral

When initializing the customer, include the referral code if available:

```swift
let savedReferralCode = UserDefaults.standard.string(forKey: "pendingReferralCode")

let customerRequest = InitializeCustomerRequest(
    customerId: "customer-123",
    email: "customer@example.com",
    referralCode: savedReferralCode  // Include referral code
)

Gameball.shared.initializeCustomer(with: customerRequest) { result in
    switch result {
    case .success(let response):
        // Customer registered with referral
        // Clear stored referral code
        UserDefaults.standard.removeObject(forKey: "pendingReferralCode")
    case .failure(let error):
        print("Error: \(error.localizedDescription)")
    }
}
```

## Get Customer Referral Link

Retrieve the customer's unique referral link to share:

```swift
Gameball.shared.getCustomerReferralInfo(for: "customer-123") { result in
    switch result {
    case .success(let referralInfo):
        let referralCode = referralInfo.referralCode
        let referralLink = referralInfo.referralLink
        
        // Display link for sharing
        showShareSheet(with: referralLink)
    case .failure(let error):
        print("Error: \(error.localizedDescription)")
    }
}
```

## Share Referral Link

Create a share sheet to let customers share their referral link:

### UIKit

```swift
func shareReferralLink(_ referralLink: String) {
    let message = "Join me on our app! Use my referral link: \(referralLink)"
    let activityVC = UIActivityViewController(
        activityItems: [message],
        applicationActivities: nil
    )
    
    present(activityVC, animated: true)
}
```

### SwiftUI

```swift
struct ReferralShareView: View {
    @State private var showShareSheet = false
    @State private var referralLink = ""
    
    var body: some View {
        Button("Share Referral Link") {
            fetchReferralLink()
        }
        .sheet(isPresented: $showShareSheet) {
            ActivityView(activityItems: ["Join me on our app! Use my referral link: \(referralLink)"])
        }
    }
    
    func fetchReferralLink() {
        Gameball.shared.getCustomerReferralInfo(for: "customer-123") { result in
            if case .success(let info) = result {
                referralLink = info.referralLink
                showShareSheet = true
            }
        }
    }
}

struct ActivityView: UIViewControllerRepresentable {
    let activityItems: [Any]
    
    func makeUIViewController(context: Context) -> UIActivityViewController {
        UIActivityViewController(activityItems: activityItems, applicationActivities: nil)
    }
    
    func updateUIViewController(_ uiViewController: UIActivityViewController, context: Context) {}
}
```

## Referral Flow

<Steps>
<Step title="Customer A Gets Referral Link">
Existing customer (referrer) gets their unique referral link from the app.
</Step>

<Step title="Customer A Shares Link">
Customer A shares the link with friends via social media, messaging, etc.
</Step>

<Step title="Customer B Clicks Link">
New customer (referee) clicks the referral link and installs the app.
</Step>

<Step title="App Captures Referral Code">
App captures the referral code from the Firebase Dynamic Link.
</Step>

<Step title="Customer B Registers">
New customer registers with the referral code included.
</Step>

<Step title="Both Customers Rewarded">
Gameball rewards both the referrer and referee based on your program configuration.
</Step>
</Steps>

<Info>
Configure referral rewards and rules in your Gameball dashboard to determine how and when referrers and referees are rewarded.
</Info>

## Info.plist Configuration

Add URL types to handle Firebase Dynamic Links:

```xml
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleTypeRole</key>
        <string>Editor</string>
        <key>CFBundleURLName</key>
        <string>com.yourcompany.yourapp</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>yourapp</string>
        </array>
    </dict>
</array>
```

## Next Steps

- [Go-Live Checklist](/installation-guide/ios-v3/go-live-checklist)
- [Migration Notes](/installation-guide/ios-v3/migration-notes)


